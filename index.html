<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ My Shop v8</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <!-- Babel (–¥–ª—è JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: { 500: '#3b82f6', 600: '#2563eb', dark: '#93c5fd' },
                        danger: '#ef4444',
                        warning: '#f59e0b',
                        success: '#10b981',
                    },
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
                },
            },
        };
    </script>
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; background-color: #f9fafb; color: #111827; }
        .fade-in { animation: fadeIn 0.25s ease-out; }
        @keyframes fadeIn { 0% { opacity: 0; } 100% { opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, createContext, useContext, useMemo, useRef } = React;
        const { Html5Qrcode } = window;
        const { XLSX } = window;
        const { Chart } = window;

        // --- Contexts ---
        const NavigationContext = createContext();
        const DataContext = createContext();

        const useNavigation = () => useContext(NavigationContext);
        const useData = () => useContext(DataContext);

        // --- Hooks ---
        function useLocalStorage(key, initialValue) {
            const [storedValue, setStoredValue] = useState(() => {
                try { return JSON.parse(window.localStorage.getItem(key)) ?? initialValue; } catch { return initialValue; }
            });
            const setValue = (value) => {
                try { const valueToStore = value instanceof Function ? value(storedValue) : value; setStoredValue(valueToStore); window.localStorage.setItem(key, JSON.stringify(valueToStore)); } catch {}
            };
            return [storedValue, setValue];
        }

        // --- Providers ---
        function DataProvider({ children }) {
            const [products, setProducts] = useLocalStorage('products', []);
            const [sales, setSales] = useLocalStorage('sales', []);
            const [movements, setMovements] = useLocalStorage('movements', []);
            const [loading, setLoading] = useState(true);

            useEffect(() => { setLoading(false); }, []);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥—É—é –Ω–æ—á—å
            useEffect(() => {
                const autoBackup = () => {
                    const now = new Date();
                    const hours = now.getHours();
                    const minutes = now.getMinutes();
                    if (hours === 0 && minutes === 0) { // –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤ 00:00
                        const data = { products, sales, movements, exportDate: now.toISOString(), version: 'v6', backupType: 'auto' };
                        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `my_shop_auto_backup_${now.toISOString().split('T')[0]}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    }
                };

                // –ó–∞–ø—É—Å–∫ —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
                autoBackup();

                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–∞ –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é –ø–æ–ª–Ω–æ—á—å
                const now = new Date();
                const nextMidnight = new Date(now);
                nextMidnight.setHours(24, 0, 0, 0);
                const timeUntilMidnight = nextMidnight - now;

                const timerId = setTimeout(autoBackup, timeUntilMidnight);

                return () => clearTimeout(timerId);
            }, [products, sales, movements]);

            const saveProduct = (productData) => {
                const dataToSave = { ...productData, stock: parseFloat(productData.stock) || 0, low_stock_threshold: parseFloat(productData.low_stock_threshold) || 5, unit: productData.unit || 'pcs' };
                setProducts(prev => prev.some(p => p.id === productData.id) ? prev.map(p => p.id === productData.id ? dataToSave : p) : [...prev, dataToSave]);
            };

            const getProductByBarcode = (barcode) => products.find(p => p.barcode === barcode);

            const addMovement = (movementData) => setMovements(prev => [movementData, ...prev]);
            const addSale = (saleData) => setSales(prev => [saleData, ...prev]);

            const handleCheckout = (cart) => {
                const total = cart.reduce((acc, item) => acc + (item.sale_price * item.quantity), 0);
                const profit = cart.reduce((acc, item) => acc + ((item.sale_price - item.purchase_price) * item.quantity), 0);
                const saleData = {
                    id: `sale_${Date.now()}`,
                    items: cart.map(item => ({
                        id: item.id, name: item.name, quantity: parseFloat(item.quantity.toFixed(item.unit === 'kg' ? 3 : 0)),
                        sale_price: item.sale_price, purchase_price: item.purchase_price, unit: item.unit
                    })),
                    total: parseFloat(total.toFixed(2)), profit: parseFloat(profit.toFixed(2)), createdAt: new Date().toISOString(), type: 'sale'
                };
                addSale(saleData);

                let updatedProducts = [...products];
                for (const item of cart) {
                    const newStock = item.stock - item.quantity;
                    updatedProducts = updatedProducts.map(p => p.id === item.id ? { ...p, stock: newStock } : p);
                    addMovement({
                        id: `move_${Date.now()}_${item.id}`, productId: item.id, name: item.name, type: 'sale', quantity: -item.quantity, unit: item.unit, date: new Date().toISOString()
                    });
                }
                setProducts(updatedProducts);
            };

            const handleReturn = ({ product, quantity, salePrice }) => {
                const qty = parseFloat(quantity);
                if (!product || isNaN(qty) || qty <= 0) throw new Error('–£–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞.');
                const finalSalePrice = salePrice != null && !isNaN(parseFloat(salePrice)) ? parseFloat(salePrice) : (product.sale_price || 0);
                const purchasePrice = product.purchase_price || 0;
                const newStock = parseFloat((product.stock + qty).toFixed(product.unit === 'kg' ? 3 : 0));
                saveProduct({ ...product, stock: newStock });
                addMovement({
                    id: `move_${Date.now()}_${product.id}`, productId: product.id, name: product.name, type: 'return', quantity: qty, unit: product.unit, date: new Date().toISOString()
                });
                const total = -(finalSalePrice * qty);
                const profit = -((finalSalePrice - purchasePrice) * qty);
                const returnSale = {
                    id: `return_${Date.now()}`,
                    items: [{ id: product.id, name: product.name, quantity: qty, sale_price: finalSalePrice, purchase_price: purchasePrice, unit: product.unit }],
                    total: parseFloat(total.toFixed(2)), profit: parseFloat(profit.toFixed(2)), createdAt: new Date().toISOString(), type: 'return'
                };
                addSale(returnSale);
            };

            const handleStockMovement = (product, quantity, type) => {
                const quantityFloat = parseFloat(quantity);
                const movementQuantity = type === 'in' ? quantityFloat : -quantityFloat;
                const newStock = product.stock + movementQuantity;
                if (newStock < 0) throw new Error(`–ù–µ–ª—å–∑—è —Å–ø–∏—Å–∞—Ç—å –±–æ–ª—å—à–µ, —á–µ–º –µ—Å—Ç—å –Ω–∞ —Å–∫–ª–∞–¥–µ! –¢–µ–∫—É—â–∏–π –æ—Å—Ç–∞—Ç–æ–∫: ${product.stock} ${product.unit}`);
                saveProduct({ ...product, stock: parseFloat(newStock.toFixed(product.unit === 'kg' ? 3 : 0)) });
                addMovement({
                    id: `move_${Date.now()}`, productId: product.id, name: product.name, type, quantity: movementQuantity, unit: product.unit, date: new Date().toISOString()
                });
            };

            const categories = useMemo(() => [...new Set(products.map(p => p.category).filter(Boolean))], [products]);
            const lowStockItems = useMemo(() => products.filter(p => p.stock <= p.low_stock_threshold), [products]);

            const handleResetData = () => {
                ['products', 'sales', 'movements'].forEach(key => window.localStorage.removeItem(key));
                setProducts([]); setSales([]); setMovements([]);
            };

            const handleImportData = (data) => {
                try {
                    const parsed = JSON.parse(data);
                    if (parsed.products && parsed.sales && parsed.movements) {
                        window.localStorage.setItem('products', JSON.stringify(parsed.products));
                        window.localStorage.setItem('sales', JSON.stringify(parsed.sales));
                        window.localStorage.setItem('movements', JSON.stringify(parsed.movements));
                        setProducts(parsed.products); setSales(parsed.sales); setMovements(parsed.movements);
                        return { success: true, message: '–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!' };
                    }
                    return { success: false, message: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞.' };
                } catch { return { success: false, message: '–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è/–ø–∞—Ä—Å–∏–Ω–≥–∞ —Ñ–∞–π–ª–∞ JSON.' }; }
            };

            const handleExportData = () => {
                const data = { products, sales, movements, exportDate: new Date().toISOString(), version: 'v6' };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a'); a.href = url; a.download = `my_shop_backup_${new Date().toISOString().split('T')[0]}.json`; document.body.appendChild(a); a.click(); document.body.removeChild(a);
            };

            const handleExportSales = () => {
                if (!XLSX) { alert("–û—à–∏–±–∫–∞: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Excel (XLSX) –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞."); return; }
                const dataToExport = sales.map(sale => ({
                    id: sale.id,
                    type: sale.type,
                    total: sale.total,
                    profit: sale.profit,
                    createdAt: sale.createdAt,
                    items: sale.items.map(item => `${item.name} (${item.quantity} ${item.unit})`).join(', ')
                }));
                const ws = XLSX.utils.json_to_sheet(dataToExport);
                const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "–ü—Ä–æ–¥–∞–∂–∏"); XLSX.writeFile(wb, "sales_export.xlsx");
            };

            const handleExportMovements = () => {
                if (!XLSX) { alert("–û—à–∏–±–∫–∞: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Excel (XLSX) –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞."); return; }
                const dataToExport = movements.map(move => ({
                    id: move.id,
                    productId: move.productId,
                    name: move.name,
                    type: move.type,
                    quantity: move.quantity,
                    unit: move.unit,
                    date: move.date
                }));
                const ws = XLSX.utils.json_to_sheet(dataToExport);
                const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "–î–≤–∏–∂–µ–Ω–∏—è"); XLSX.writeFile(wb, "movements_export.xlsx");
            };

            const exportStatsToExcel = (stats) => {
                if (!XLSX) { alert("–û—à–∏–±–∫–∞: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Excel (XLSX) –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞."); return; }
                const statsSheet = [
                    { –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å: '–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–µ–∫–æ–≤', –ó–Ω–∞—á–µ–Ω–∏–µ: stats.salesCount },
                    { –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å: '–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞', –ó–Ω–∞—á–µ–Ω–∏–µ: stats.totalRevenue },
                    { –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å: '–û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å', –ó–Ω–∞—á–µ–Ω–∏–µ: stats.totalProfit },
                    { –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å: '–°—Ä–µ–¥–Ω–∏–π —á–µ–∫', –ó–Ω–∞—á–µ–Ω–∏–µ: stats.avgCheck },
                    { –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å: '–°—Ä–µ–¥–Ω—è—è –ø—Ä–∏–±—ã–ª—å', –ó–Ω–∞—á–µ–Ω–∏–µ: stats.avgProfit },
                ];
                const topProductsSheet = stats.topProducts.map(p => ({ –ù–∞–∑–≤–∞–Ω–∏–µ: p.name, –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: p.count, –í—ã—Ä—É—á–∫–∞: p.revenue, –ü—Ä–∏–±—ã–ª—å: p.profit }));
                const topCategoriesSheet = stats.topCategories.map(c => ({ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: c.name, –í—ã—Ä—É—á–∫–∞: c.revenue, –ü—Ä–∏–±—ã–ª—å: c.profit }));

                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(statsSheet), "–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏");
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(topProductsSheet), "–¢–æ–ø-5 —Ç–æ–≤–∞—Ä–æ–≤");
                XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(topCategoriesSheet), "–¢–æ–ø-5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π");
                XLSX.writeFile(wb, "statistics_export.xlsx");
            };

            const value = useMemo(() => ({
                products, sales, movements, loading, categories, lowStockItems, saveProduct, getProductByBarcode,
                handleCheckout, handleStockMovement, handleResetData, handleImportData, handleExportData, handleReturn,
                handleExportSales, handleExportMovements, exportStatsToExcel,
            }), [products, sales, movements, loading, categories, lowStockItems]);

            return <DataContext.Provider value={value}>{children}</DataContext.Provider>;
        }

        function NavigationProvider({ children }) {
            const [page, setPage] = useState('dashboard');
            const navigate = (pageName) => setPage(pageName);
            const value = useMemo(() => ({ page, navigate }), [page]);
            return <NavigationContext.Provider value={value}>{children}</NavigationContext.Provider>;
        }

        // --- Components ---
        function App() {
            const { page } = useNavigation();
            let currentPage;
            switch (page) {
                case 'inventory': currentPage = <InventoryPage />; break;
                case 'pos': currentPage = <POSPage />; break;
                case 'returns': currentPage = <ReturnsPage />; break;
                case 'stock': currentPage = <StockPage />; break;
                case 'stats': currentPage = <StatsPage />; break;
                case 'checks': currentPage = <ChecksPage />; break;
                case 'categories': currentPage = <CategoriesPage />; break;
                case 'settings': currentPage = <SettingsPage />; break;
                default: currentPage = <DashboardPage />;
            }
            return <Layout>{currentPage}</Layout>;
        }

        function Layout({ children }) {
            const { page, navigate } = useNavigation();
            const { lowStockItems } = useData();
            const navItems = [
                { id: 'dashboard', label: '–ì–ª–∞–≤–Ω–∞—è', icon: 'üè†', badge: lowStockItems.length },
                { id: 'pos', label: '–ö–∞—Å—Å–∞', icon: 'üõí' },
                { id: 'returns', label: '–í–æ–∑–≤—Ä–∞—Ç', icon: '‚Ü©Ô∏è' },
                { id: 'inventory', label: '–¢–æ–≤–∞—Ä—ã', icon: 'üì¶' },
                { id: 'stock', label: '–°–∫–ª–∞–¥', icon: 'üè¨' },
                { id: 'stats', label: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', icon: 'üìä' },
                { id: 'checks', label: '–ß–µ–∫–∏', icon: 'üßæ' },
                { id: 'categories', label: '–ö–∞—Ç–µ–≥–æ—Ä–∏–∏', icon: 'üè∑Ô∏è' },
                { id: 'settings', label: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏', icon: '‚öôÔ∏è' },
            ];

            return (
                <div className="flex h-screen w-full">
                    <aside className="hidden md:flex flex-col w-64 bg-white border-r border-gray-200">
                        <div className="p-4 flex flex-col items-center border-b">
                            <h1 className="text-xl font-bold text-blue-500">üí∞ My Shop v8</h1>
                        </div>
                        <nav className="flex-1 p-2 space-y-1">
                            {navItems.map(item => (
                                <button key={item.id} onClick={() => navigate(item.id)}
                                    className={`flex items-center gap-3 px-3 py-2.5 rounded-lg transition-colors ${
                                        page === item.id ? 'bg-blue-100 text-blue-500 font-medium' : 'text-gray-600 hover:bg-blue-50'
                                    }`}>
                                    <span className="text-lg">{item.icon}</span>
                                    <span className="text-sm">{item.label}</span>
                                    {item.badge > 0 && <span className="ml-auto bg-red-500 text-white text-xs font-bold px-1.5 py-0.5 rounded-full">{item.badge}</span>}
                                </button>
                            ))}
                        </nav>
                    </aside>
                    <main className="flex-1 overflow-auto p-2 md:p-4 pb-20 md:pb-4">{children}</main>
                    <nav className="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 flex justify-around p-1 z-40">
                        {navItems.map(item => (
                            <button key={item.id} onClick={() => navigate(item.id)}
                                className={`flex flex-col items-center justify-center p-2 rounded-lg w-full ${
                                    page === item.id ? 'bg-blue-50 text-blue-500' : ''
                                }`}>
                                <div className="relative">
                                    <span className="text-xl">{item.icon}</span>
                                    {item.badge > 0 && <span className="absolute top-0 right-0 transform translate-x-1/2 -translate-y-1/2 bg-red-500 text-white text-xs font-bold px-1 rounded-full">{item.badge}</span>}
                                </div>
                                <span className="text-xs mt-1">{item.label}</span>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        }

        function SettingsPage() {
            const { navigate } = useNavigation();
            return (
                <div className="space-y-6 fade-in">
                    <h1 className="text-2xl font-bold">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h1>
                    <DataManagement />
                    <FullReset />
                    <button onClick={() => navigate('returns')} className="w-full py-2.5 px-4 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium flex items-center justify-center gap-2">
                        <span>‚Ü©Ô∏è</span> <span>–í–æ–∑–≤—Ä–∞—Ç</span>
                    </button>
                </div>
            );
        }

        function DataManagement() {
            const { handleExportData, handleImportData, handleExportSales, handleExportMovements } = useData();
            const fileInputRef = useRef(null);
            const [message, setMessage] = useState(null);

            const handleFileImport = (e) => {
                const file = e.target.files[0]; if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    const result = handleImportData(event.target.result);
                    setMessage(result.message);
                    if (result.success) setTimeout(() => setMessage(null), 3000);
                };
                reader.readAsText(file);
                if (fileInputRef.current) fileInputRef.current.value = null;
            };

            const triggerFileInput = () => fileInputRef.current.click();

            return (
                <div className="bg-white p-4 rounded-lg shadow">
                    <h2 className="text-lg font-bold mb-2">–ë—ç–∫–∞–ø</h2>
                    <div className="flex flex-col sm:flex-row gap-2">
                        <button onClick={handleExportData} className="flex-1 py-2 px-3 bg-green-500 hover:bg-green-600 text-white rounded text-sm font-medium">[‚¨áÔ∏è] –≠–∫—Å–ø–æ—Ä—Ç (–í—Å–µ –¥–∞–Ω–Ω—ã–µ)</button>
                        <input type="file" ref={fileInputRef} onChange={handleFileImport} className="hidden" accept=".json" />
                        <button onClick={triggerFileInput} className="flex-1 py-2 px-3 bg-orange-500 hover:bg-orange-600 text-white rounded text-sm font-medium">[‚¨ÜÔ∏è] –ò–º–ø–æ—Ä—Ç</button>
                    </div>
                    <div className="mt-2 flex flex-col sm:flex-row gap-2">
                        <button onClick={handleExportSales} className="flex-1 py-2 px-3 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-medium">[‚¨áÔ∏è] –≠–∫—Å–ø–æ—Ä—Ç –ü—Ä–æ–¥–∞–∂</button>
                        <button onClick={handleExportMovements} className="flex-1 py-2 px-3 bg-purple-500 hover:bg-purple-600 text-white rounded text-sm font-medium">[‚¨áÔ∏è] –≠–∫—Å–ø–æ—Ä—Ç –î–≤–∏–∂–µ–Ω–∏–π</button>
                    </div>
                    {message && <p className={`mt-2 text-xs ${message.startsWith('–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ') ? 'text-green-500' : 'text-red-500'}`}>{message}</p>}
                </div>
            );
        }

        function FullReset() {
            const { handleResetData } = useData();
            const handleReset = () => {
                if (window.confirm('–£–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ? –î–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ!')) { handleResetData(); window.location.reload(); }
            };
            return (
                <div className="bg-red-100 p-4 rounded-lg shadow border-l-4 border-red-500">
                    <h2 className="text-lg font-bold text-red-500">–°–±—Ä–æ—Å</h2>
                    <button onClick={handleReset} className="w-full py-2 px-3 bg-red-500 hover:bg-red-600 text-white rounded text-sm font-medium">[üí£] –£–¥–∞–ª–∏—Ç—å –≤—Å–µ</button>
                </div>
            );
        }

        function DashboardPage() {
            const { navigate } = useNavigation();
            const { lowStockItems } = useData();

            return (
                <div className="fade-in">
                    <h1 className="text-2xl font-bold mb-4">–†–∞–±–æ—á–∏–π —Å—Ç–æ–ª</h1>
                    {lowStockItems.length > 0 && (
                        <div className="bg-red-100 p-3 rounded-lg mb-4 border-l-4 border-red-500">
                            <h2 className="text-lg font-bold text-red-600 mb-1">üö® –ù–∏–∑–∫–∏–π –æ—Å—Ç–∞—Ç–æ–∫ ({lowStockItems.length})</h2>
                            <div className="flex flex-wrap gap-1.5 max-h-24 overflow-auto">
                                {lowStockItems.map(p => (
                                    <span key={p.id} className="bg-red-200 text-red-800 text-xs px-2 py-0.5 rounded-full font-medium">
                                        {p.name} ({p.stock.toFixed(p.unit === 'kg' ? 3 : 0)} {p.unit})
                                    </span>
                                ))}
                            </div>
                            <div className="mt-2 flex gap-2">
                                <button onClick={() => navigate('inventory')} className="text-xs text-red-600 font-medium hover:underline">–¢–æ–≤–∞—Ä—ã</button>
                                <button onClick={() => navigate('stock')} className="text-xs text-red-600 font-medium hover:underline">–°–∫–ª–∞–¥</button>
                            </div>
                        </div>
                    )}
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <DashboardCard title="–ö–∞—Å—Å–∞" description="–ù–∞—á–∞—Ç—å –ø—Ä–æ–¥–∞–∂—É" icon="üõí" onClick={() => navigate('pos')} color="blue" />
                        <DashboardCard title="–í–æ–∑–≤—Ä–∞—Ç" description="–û—Ñ–æ—Ä–º–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç" icon="‚Ü©Ô∏è" onClick={() => navigate('returns')} color="gray" />
                        <DashboardCard title="–¢–æ–≤–∞—Ä—ã" description="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–º" icon="üì¶" onClick={() => navigate('inventory')} color="green" />
                        <DashboardCard title="–°–∫–ª–∞–¥" description="–ü—Ä–∏—Ö–æ–¥/—Å–ø–∏—Å–∞–Ω–∏–µ" icon="üè¨" onClick={() => navigate('stock')} color="orange" />
                        <DashboardCard title="–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞" description="–ê–Ω–∞–ª–∏—Ç–∏–∫–∞" icon="üìä" onClick={() => navigate('stats')} color="purple" />
                        <DashboardCard title="–ß–µ–∫–∏" description="–ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö —á–µ–∫–æ–≤" icon="üßæ" onClick={() => navigate('checks')} color="yellow" />
                        <DashboardCard title="–ö–∞—Ç–µ–≥–æ—Ä–∏–∏" description="–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏" icon="üè∑Ô∏è" onClick={() => navigate('categories')} color="pink" />
                        <DashboardCard title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏" description="–ë—ç–∫–∞–ø" icon="‚öôÔ∏è" onClick={() => navigate('settings')} color="gray" />
                    </div>
                </div>
            );
        }

        const DashboardCard = ({ title, description, icon, onClick, color }) => {
            const colors = { blue: "bg-blue-500 hover:bg-blue-600", green: "bg-green-500 hover:bg-green-600", orange: "bg-orange-500 hover:bg-orange-600", purple: "bg-purple-500 hover:bg-purple-600", gray: "bg-gray-500 hover:bg-gray-600", yellow: "bg-yellow-500 hover:bg-yellow-600", pink: "bg-pink-500 hover:bg-pink-600" };
            return (
                <button onClick={onClick} className={`bg-white p-4 rounded-lg shadow text-white ${colors[color] || colors.blue} transition-transform hover:scale-[1.02]`}>
                    <span className="text-2xl mb-1 block">{icon}</span>
                    <h3 className="font-bold mb-1">{title}</h3>
                    <p className="text-xs">{description}</p>
                </button>
            );
        };

        function POSPage() {
            const { products, getProductByBarcode, handleCheckout } = useData();
            const [cart, setCart] = useState([]);
            const [showScanner, setShowScanner] = useState(false);
            const [message, setMessage] = useState(null);
            const [searchQuery, setSearchQuery] = useState('');
            const [weightPrompt, setWeightPrompt] = useState(null);
            const [tempProduct, setTempProduct] = useState(null);

            const showMessage = (text, type = 'success') => { setMessage({ text, type }); setTimeout(() => setMessage(null), 3000); };

            const addItemToCart = (product, quantity = 1) => {
                setSearchQuery('');
                if (product.unit === 'kg' && quantity === 1) { setTempProduct(product); setWeightPrompt(true); return; }
                if (product.stock < quantity) { showMessage(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ "${product.name}"! –û—Å—Ç–∞–ª–æ—Å—å: ${product.stock.toFixed(product.unit === 'kg' ? 3 : 0)}`, 'error'); return; }
                setCart(prev => {
                    const existing = prev.find(i => i.id === product.id);
                    if (existing) {
                        const newQty = existing.quantity + quantity;
                        if (newQty > product.stock) { showMessage(`–ë–æ–ª—å—à–µ –Ω–µ—Ç "${product.name}"!`, 'error'); return prev; }
                        return prev.map(i => i.id === product.id ? { ...i, quantity: newQty } : i);
                    }
                    return [...prev, { ...product, quantity }];
                });
                showMessage(`–î–æ–±–∞–≤–ª–µ–Ω: ${product.name}`);
            };

            const handleWeightSubmit = (weight) => { if (tempProduct && weight > 0) addItemToCart(tempProduct, weight); setWeightPrompt(false); setTempProduct(null); };

            const onScanSuccess = (decodedText) => { const product = getProductByBarcode(decodedText); if (product) addItemToCart(product); else showMessage('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error'); setShowScanner(false); };

            const removeFromCart = (productId) => setCart(prev => prev.filter(i => i.id !== productId));

            const updateQuantity = (productId, newQuantity) => {
                const productInInventory = products.find(p => p.id === productId);
                const quantityFloat = parseFloat(newQuantity) || 0;
                if (quantityFloat > productInInventory.stock) { showMessage(`–ú–∞–∫—Å–∏–º—É–º: ${productInInventory.stock.toFixed(productInInventory.unit === 'kg' ? 3 : 0)}`, 'error'); newQuantity = productInInventory.stock; }
                if (quantityFloat <= 0) { removeFromCart(productId); return; }
                setCart(prev => prev.map(i => i.id === productId ? { ...i, quantity: quantityFloat } : i));
            };

            const total = cart.reduce((acc, i) => acc + (i.sale_price * i.quantity), 0);

            const onCheckout = () => {
                if (cart.length === 0) return;
                try { handleCheckout(cart); setCart([]); showMessage('–ü—Ä–æ–¥–∞–∂–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∞!'); } catch { showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏!', 'error'); }
            };

            const filteredProducts = useMemo(() => {
                if (searchQuery.length < 2) return [];
                return products.filter(p => p.name.toLowerCase().includes(searchQuery.toLowerCase())).slice(0, 10);
            }, [searchQuery, products]);

            return (
                <div className="flex flex-col md:flex-row gap-4 h-full fade-in">
                    <div className="bg-white rounded-lg shadow w-full md:w-2/3 h-full flex flex-col">
                        <h2 className="text-lg font-bold p-2 border-b">–ß–µ–∫</h2>
                        <div className="flex-1 overflow-auto p-2 space-y-2">
                            {cart.length === 0 ? <p className="text-gray-500 text-center py-6">–ß–µ–∫ –ø—É—Å—Ç</p> : cart.map(item => (
                                <div key={item.id} className="flex items-center gap-2 p-2 rounded bg-gray-50">
                                    <div className="flex-1">
                                        <p className="text-sm font-medium">{item.name}</p>
                                        <p className="text-xs text-gray-500">{item.sale_price} ‚ÇΩ / {item.unit}</p>
                                    </div>
                                    <div className="flex items-center gap-1.5">
                                        <input type="number" step={item.unit === 'kg' ? "0.001" : "1"} value={item.quantity}
                                            onChange={(e) => updateQuantity(item.id, e.target.value)} className="w-20 px-2 py-1 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-center text-sm"
                                            max={item.stock} min={item.unit === 'kg' ? "0.001" : "1"} />
                                        <span className="font-bold text-sm w-20 text-right">{(item.sale_price * item.quantity).toFixed(2)} ‚ÇΩ</span>
                                    </div>
                                    <button onClick={() => removeFromCart(item.id)} className="text-red-500 hover:text-red-700 text-lg">üóëÔ∏è</button>
                                </div>
                            ))}
                        </div>
                        <div className="p-2 border-t">
                            <div className="flex justify-between items-center text-lg font-bold">
                                <span>–ò—Ç–æ–≥–æ:</span><span>{total.toFixed(2)} ‚ÇΩ</span>
                            </div>
                        </div>
                    </div>
                    <div className="w-full md:w-1/3 space-y-3">
                        <button className="w-full py-2.5 px-4 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-medium" onClick={() => setShowScanner(true)}>[|||] –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                        <div className="bg-white p-3 rounded-lg shadow">
                            <h3 className="text-sm font-medium mb-1">–ü–æ–∏—Å–∫</h3>
                            <input type="text" placeholder="2+ —Å–∏–º–≤–æ–ª–∞..." className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} />
                            {filteredProducts.length > 0 && (
                                <div className="mt-2 space-y-1 max-h-40 overflow-auto">
                                    {filteredProducts.map(p => (
                                        <div key={p.id} className="flex justify-between items-center p-1.5 bg-gray-50 rounded">
                                            <div>
                                                <p className="text-sm font-medium">{p.name}</p>
                                                <p className="text-xs text-gray-500">{p.sale_price} ‚ÇΩ / {p.unit} (–û—Å—Ç: {p.stock.toFixed(p.unit === 'kg' ? 3 : 0)})</p>
                                            </div>
                                            <button onClick={() => addItemToCart(p)} className="px-2 py-0.5 bg-blue-500 hover:bg-blue-600 text-white rounded text-xs font-medium" disabled={p.stock <= 0}>
                                                {p.unit === 'kg' ? '–í–µ—Å' : '+1'}
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                        <div className="sticky bottom-0 bg-white p-3 rounded-lg shadow border-t">
                            <button className="w-full py-2.5 px-4 bg-green-500 hover:bg-green-600 text-white rounded-lg font-medium" onClick={onCheckout} disabled={cart.length === 0}>$ –û—Ñ–æ—Ä–º–∏—Ç—å –ø—Ä–æ–¥–∞–∂—É</button>
                        </div>
                    </div>
                    {showScanner && <Modal title="–°–∫–∞–Ω–µ—Ä" onClose={() => setShowScanner(false)}><BarcodeScannerComponent onSuccess={onScanSuccess} onError={(err) => console.warn(err)} /></Modal>}
                    {weightPrompt && tempProduct && <WeightInputModal product={tempProduct} onClose={() => setWeightPrompt(false)} onConfirm={handleWeightSubmit} />}
                    {message && <Notification type={message.type} message={message.text} />}
                </div>
            );
        }

        function ReturnsPage() {
            const { products, getProductByBarcode, handleReturn } = useData();
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [quantity, setQuantity] = useState('');
            const [salePrice, setSalePrice] = useState('');
            const [searchQuery, setSearchQuery] = useState('');
            const [showScanner, setShowScanner] = useState(false);
            const [message, setMessage] = useState(null);

            const showMessage = (text, type = 'success') => { setMessage({ text, type }); setTimeout(() => setMessage(null), 3000); };

            const filteredProducts = useMemo(() => {
                if (searchQuery.length < 2) return [];
                return products.filter(p => p.name.toLowerCase().includes(searchQuery.toLowerCase())).slice(0, 10);
            }, [searchQuery, products]);

            const onScanSuccess = (decodedText) => {
                const product = getProductByBarcode(decodedText);
                if (product) { setSelectedProduct(product); setSalePrice(product.sale_price || ''); }
                else showMessage('–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
                setShowScanner(false);
            };

            const submitReturn = (e) => {
                e.preventDefault();
                try {
                    if (!selectedProduct) { showMessage('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä', 'error'); return; }
                    const qty = parseFloat(quantity);
                    if (isNaN(qty) || qty <= 0) { showMessage('–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ > 0', 'error'); return; }
                    handleReturn({ product: selectedProduct, quantity: qty, salePrice: salePrice !== '' ? parseFloat(salePrice) : undefined });
                    setQuantity(''); showMessage('–í–æ–∑–≤—Ä–∞—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω!');
                } catch (err) { showMessage(err.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ', 'error'); }
            };

            return (
                <div className="space-y-4 fade-in">
                    <h1 className="text-2xl font-bold">–í–æ–∑–≤—Ä–∞—Ç</h1>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div className="bg-white p-4 rounded-lg shadow md:col-span-2">
                            <h2 className="text-lg font-medium mb-3">–í—ã–±–æ—Ä —Ç–æ–≤–∞—Ä–∞</h2>
                            <div className="flex gap-2 mb-3">
                                <button className="py-1.5 px-3 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-medium" onClick={() => setShowScanner(true)}>[|||] –°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
                                <div className="flex-1">
                                    <input type="text" className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" placeholder="–ü–æ–∏—Å–∫: 2+ —Å–∏–º–≤–æ–ª–∞..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)} />
                                    {filteredProducts.length > 0 && (
                                        <div className="mt-2 space-y-1 max-h-40 overflow-auto">
                                            {filteredProducts.map(p => (
                                                <button key={p.id} className={`w-full text-left p-1.5 rounded ${
                                                    selectedProduct?.id === p.id ? 'bg-blue-100' : 'bg-gray-50 hover:bg-gray-100'
                                                }`} onClick={() => { setSelectedProduct(p); setSalePrice(p.sale_price || ''); }}>
                                                    <div className="flex justify-between items-center">
                                                        <div>
                                                            <p className="text-sm font-medium">{p.name}</p>
                                                            <p className="text-xs text-gray-500">–¶–µ–Ω–∞: {p.sale_price} ‚ÇΩ / {p.unit}</p>
                                                        </div>
                                                        <span className="text-xs text-gray-500">–û—Å—Ç: {p.stock.toFixed(p.unit === 'kg' ? 3 : 0)} {p.unit}</span>
                                                    </div>
                                                </button>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                            <form onSubmit={submitReturn} className="space-y-3">
                                <div>
                                    <label className="block text-sm font-medium mb-1">–í—ã–±—Ä–∞–Ω–Ω—ã–π —Ç–æ–≤–∞—Ä</label>
                                    <input className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white text-sm" value={selectedProduct ? selectedProduct.name : ''} placeholder="–ù–µ –≤—ã–±—Ä–∞–Ω" disabled />
                                </div>
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
                                    <div>
                                        <label className="block text-sm font-medium mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ ({selectedProduct?.unit || '—à—Ç'})</label>
                                        <input type="number" className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" step={selectedProduct?.unit === 'kg' ? '0.001' : '1'} min={selectedProduct?.unit === 'kg' ? '0.001' : '1'} value={quantity} onChange={(e) => setQuantity(e.target.value)} required />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-medium mb-1">–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ (‚ÇΩ / {selectedProduct?.unit || '—à—Ç'})</label>
                                        <input type="number" className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" step="0.01" value={salePrice} onChange={(e) => setSalePrice(e.target.value)} placeholder={selectedProduct ? String(selectedProduct.sale_price || 0) : ''} />
                                    </div>
                                </div>
                                <button type="submit" className="w-full py-2 px-3 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-medium disabled:opacity-50" disabled={!selectedProduct || !quantity}>–û—Ñ–æ—Ä–º–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç</button>
                            </form>
                        </div>
                        <div className="bg-white p-4 rounded-lg shadow">
                            <h2 className="text-lg font-medium mb-3">–ü–æ—è—Å–Ω–µ–Ω–∏—è</h2>
                            <ul className="space-y-1 text-xs text-gray-600">
                                <li>‚Ä¢ –í–æ–∑–≤—Ä–∞—Ç —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –æ—Å—Ç–∞—Ç–æ–∫ –Ω–∞ —Å–∫–ª–∞–¥–µ.</li>
                                <li>‚Ä¢ –í –¥–≤–∏–∂–µ–Ω–∏—è—Ö –ø–æ—è–≤–ª—è–µ—Ç—Å—è –∑–∞–ø–∏—Å—å "–í–æ–∑–≤—Ä–∞—Ç".</li>
                                <li>‚Ä¢ –í —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ –≤—ã—á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ –≤—ã—Ä—É—á–∫–∏ –∏ –ø—Ä–∏–±—ã–ª–∏.</li>
                                <li>‚Ä¢ –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Ü–µ–Ω—É –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤—Ä—É—á–Ω—É—é.</li>
                            </ul>
                        </div>
                    </div>
                    {showScanner && <Modal title="–°–∫–∞–Ω–µ—Ä" onClose={() => setShowScanner(false)}><BarcodeScannerComponent onSuccess={onScanSuccess} onError={(err) => console.warn(err)} /></Modal>}
                    {message && <Notification type={message.type} message={message.text} />}
                </div>
            );
        }

        function InventoryPage() {
            const { products, loading, saveProduct, getProductByBarcode, categories, lowStockItems } = useData();
            const [showModal, setShowModal] = useState(false);
            const [productToEdit, setProductToEdit] = useState(null);
            const [search, setSearch] = useState('');
            const [filterCategory, setFilterCategory] = useState('all');
            const { navigate } = useNavigation();
            const fileInputRef = useRef(null);

            const filteredProducts = useMemo(() => {
                return products.filter(p => {
                    const matchesSearch = p.name.toLowerCase().includes(search.toLowerCase()) || (p.barcode && p.barcode.includes(search));
                    const matchesCategory = filterCategory === 'all' || (filterCategory === 'none' && !p.category) || p.category === filterCategory;
                    return matchesSearch && matchesCategory;
                });
            }, [products, search, filterCategory]);

            const handleExport = () => {
                if (!XLSX) { alert("–û—à–∏–±–∫–∞: –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ Excel (XLSX) –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞."); return; }
                const dataToExport = products.map(p => ({
                    id: p.id, name: p.name, barcode: p.barcode || '',
                    purchase_price: p.purchase_price, sale_price: p.sale_price,
                    stock: p.stock, category: p.category || '', unit: p.unit || 'pcs',
                    low_stock_threshold: p.low_stock_threshold || 5,
                }));
                const ws = XLSX.utils.json_to_sheet(dataToExport);
                const wb = XLSX.utils.book_new(); XLSX.utils.book_append_sheet(wb, ws, "–¢–æ–≤–∞—Ä—ã"); XLSX.writeFile(wb, "products_export.xlsx");
            };

            const handleImport = (event) => {
                const file = event.target.files[0]; if (!file || !XLSX) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const sheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[sheetName];
                        const json = XLSX.utils.sheet_to_json(worksheet);
                        let importedCount = 0, skippedCount = 0;
                        json.forEach(item => {
                            if (!item.name || item.sale_price == null) { skippedCount++; return; }
                            const id = item.id || `prod_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                            if (item.barcode) {
                                const existingByBarcode = getProductByBarcode(item.barcode);
                                if (existingByBarcode && existingByBarcode.id !== id) { skippedCount++; return; }
                            }
                            const productData = {
                                id, name: String(item.name), barcode: item.barcode ? String(item.barcode) : '',
                                purchase_price: parseFloat(item.purchase_price) || 0, sale_price: parseFloat(item.sale_price) || 0,
                                stock: parseFloat(item.stock) || 0, category: item.category ? String(item.category) : '',
                                unit: item.unit ? String(item.unit) : 'pcs', low_stock_threshold: parseFloat(item.low_stock_threshold) || 5,
                            };
                            saveProduct(productData); importedCount++;
                        });
                        alert(`–ò–º–ø–æ—Ä—Ç –∑–∞–≤–µ—Ä—à–µ–Ω!\n–î–æ–±–∞–≤–ª–µ–Ω–æ/–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${importedCount}\n–ü—Ä–æ–ø—É—â–µ–Ω–æ: ${skippedCount}`);
                    } catch { alert("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞."); } finally { if (fileInputRef.current) fileInputRef.current.value = null; }
                };
                reader.readAsArrayBuffer(file);
            };

            const triggerFileInput = () => fileInputRef.current.click();

            return (
                <div className="fade-in">
                    <div className="flex flex-col md:flex-row gap-3 mb-3">
                        <div className="flex-1 flex gap-3">
                            <h1 className="text-2xl font-bold mb-0">–¢–æ–≤–∞—Ä—ã</h1>
                            <button className="h-8 px-3 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-medium" onClick={() => navigate('returns')}>‚Ü©Ô∏è –í–æ–∑–≤—Ä–∞—Ç</button>
                        </div>
                        <button className="h-8 px-3 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-medium" onClick={() => { setProductToEdit(null); setShowModal(true); }}>[+] –î–æ–±–∞–≤–∏—Ç—å</button>
                    </div>
                    <div className="flex flex-col md:flex-row gap-3 mb-3">
                        <div className="relative flex-1">
                            <input type="text" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ —à—Ç—Ä–∏—Ö-–∫–æ–¥—É..." className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" value={search} onChange={(e) => setSearch(e.target.value)} />
                        </div>
                        <div className="flex-1">
                            <select className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" value={filterCategory} onChange={(e) => setFilterCategory(e.target.value)}>
                                <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                                {categories.map(c => <option key={c} value={c}>{c}</option>)}
                                <option value="none">–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                            </select>
                        </div>
                    </div>
                    <div className="flex gap-3 mb-3">
                        <input type="file" ref={fileInputRef} onChange={handleImport} className="hidden" accept=".xlsx, .xls" />
                        <button className="py-1.5 px-3 bg-gray-200 hover:bg-gray-300 rounded text-sm font-medium" onClick={triggerFileInput}>[‚Üì] –ò–º–ø–æ—Ä—Ç Excel</button>
                        <button className="py-1.5 px-3 bg-gray-200 hover:bg-gray-300 rounded text-sm font-medium" onClick={handleExport}>[‚Üë] –≠–∫—Å–ø–æ—Ä—Ç Excel</button>
                    </div>
                    {loading ? (<p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>) : (
                        <div className="bg-white rounded-lg shadow overflow-hidden">
                            <table className="w-full text-left">
                                <thead className="border-b">
                                    <tr>
                                        <th className="p-3 text-sm font-medium">–ù–∞–∑–≤–∞–Ω–∏–µ</th>
                                        <th className="p-3 text-sm font-medium hidden md:table-cell">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</th>
                                        <th className="p-3 text-sm font-medium">–û—Å—Ç–∞—Ç–æ–∫ ({lowStockItems.length})</th>
                                        <th className="p-3 text-sm font-medium">–¶–µ–Ω–∞</th>
                                        <th className="p-3 text-sm font-medium w-10"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredProducts.map(product => {
                                        const isLowStock = product.stock <= product.low_stock_threshold;
                                        const rowClass = isLowStock ? 'bg-red-50' : 'hover:bg-gray-50';
                                        return (
                                            <tr key={product.id} className={`border-b dark:border-gray-700 last:border-0 ${rowClass}`}>
                                                <td className="p-3 text-sm">{product.name}</td>
                                                <td className="p-3 text-sm hidden md:table-cell">{product.category || 'N/A'}</td>
                                                <td className="p-3">
                                                    <span className={`px-1.5 py-0.5 rounded-full text-xs font-bold ${
                                                        isLowStock ? 'bg-red-500 text-white animate-pulse' :
                                                        product.stock > 0 ? 'bg-green-100 text-green-800' :
                                                        'bg-gray-200 text-gray-800'
                                                    }`}>
                                                        {product.stock.toFixed(product.unit === 'kg' ? 3 : 0)} {product.unit}
                                                    </span>
                                                </td>
                                                <td className="p-3 text-sm font-bold">{product.sale_price} ‚ÇΩ / {product.unit}</td>
                                                <td className="p-3 text-right">
                                                    <button onClick={() => { setProductToEdit(product); setShowModal(true); }} className="text-blue-500 text-sm">[‚úèÔ∏è]</button>
                                                </td>
                                            </tr>
                                        );
                                    })}
                                </tbody>
                            </table>
                            {filteredProducts.length === 0 && <p className="p-3 text-center text-gray-500 text-sm">–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>}
                        </div>
                    )}
                    {showModal && <ProductModal product={productToEdit} onClose={() => setShowModal(false)} />}
                </div>
            );
        }

        function StockPage() {
            const { products, movements, handleStockMovement } = useData();
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [quantity, setQuantity] = useState(1);
            const [type, setType] = useState('in');
            const last10Movements = movements.slice(0, 10);
            const product = products.find(p => p.id === selectedProduct);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!product || quantity <= 0) { alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –∏ —É–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ'); return; }
                try { handleStockMovement(product, quantity, type); alert('–î–≤–∏–∂–µ–Ω–∏–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ!'); setSelectedProduct(null); setQuantity(1); }
                catch (error) { alert(error.message); }
            };

            return (
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 fade-in">
                    <div className="bg-white p-4 rounded-lg shadow">
                        <h2 className="text-lg font-bold mb-3">–î–≤–∏–∂–µ–Ω–∏–µ</h2>
                        <form onSubmit={handleSubmit} className="space-y-3">
                            <div>
                                <label className="block text-sm font-medium mb-1">–¢–∏–ø –æ–ø–µ—Ä–∞—Ü–∏–∏</label>
                                <select value={type} onChange={(e) => setType(e.target.value)} className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm">
                                    <option value="in">–ü—Ä–∏—Ö–æ–¥</option>
                                    <option value="out">–°–ø–∏—Å–∞–Ω–∏–µ</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-1">–¢–æ–≤–∞—Ä</label>
                                <select value={selectedProduct || ''} onChange={(e) => setSelectedProduct(e.target.value)} className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm">
                                    <option value="" disabled>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä...</option>
                                    {products.map(p => (<option key={p.id} value={p.id}>{p.name} (–û—Å—Ç: {p.stock.toFixed(p.unit === 'kg' ? 3 : 0)} {p.unit})</option>))}
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ ({product?.unit || '—à—Ç'})</label>
                                <input type="number" step={product?.unit === 'kg' ? "0.001" : "1"} value={quantity}
                                    onChange={(e) => setQuantity(e.target.value)} className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" min={product?.unit === 'kg' ? "0.001" : "1"} />
                            </div>
                            <button type="submit" className="w-full py-2 px-3 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-medium">{type === 'in' ? '–û–ø—Ä–∏—Ö–æ–¥–æ–≤–∞—Ç—å' : '–°–ø–∏—Å–∞—Ç—å'}</button>
                        </form>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow">
                        <h2 className="text-lg font-bold mb-3">–ü–æ—Å–ª–µ–¥–Ω–∏–µ 10</h2>
                        <div className="space-y-2 overflow-auto max-h-80">
                            {last10Movements.length === 0 ? <p className="text-sm">–û–ø–µ—Ä–∞—Ü–∏–π –Ω–µ—Ç.</p> :
                                last10Movements.map(m => (
                                    <div key={m.id} className="flex justify-between p-2 bg-gray-50 rounded text-sm">
                                        <div>
                                            <p className="font-medium">{m.name}</p>
                                            <p className="text-xs text-gray-500">{new Date(m.date).toLocaleString()}</p>
                                        </div>
                                        <div className={`font-bold ${m.quantity > 0 ? 'text-green-500' : 'text-red-500'}`}>
                                            {m.quantity > 0 ? `+${m.quantity.toFixed(m.unit === 'kg' ? 3 : 0)}` : m.quantity.toFixed(m.unit === 'kg' ? 3 : 0)} {m.unit}
                                            <span className="text-xs ml-1">
                                                {m.type === 'in' ? '(–ü—Ä–∏—Ö–æ–¥)' : m.type === 'out' ? '(–°–ø–∏—Å–∞–Ω–∏–µ)' : m.type === 'sale' ? '(–ü—Ä–æ–¥–∞–∂–∞)' : m.type === 'return' ? '(–í–æ–∑–≤—Ä–∞—Ç)' : ''}
                                            </span>
                                        </div>
                                    </div>
                                ))
                            }
                        </div>
                    </div>
                </div>
            );
        }

        function StatsPage() {
            const { sales, loading } = useData();
            const [filter, setFilter] = useState('all');

            const isToday = (date) => {
                const today = new Date();
                return date.getDate() === today.getDate() && date.getMonth() === today.getMonth() && date.getFullYear() === today.getFullYear();
            };
            const isThisWeek = (date) => {
                const today = new Date();
                const firstDayOfWeek = new Date(today.setDate(today.getDate() - today.getDay() + (today.getDay() === 0 ? -6 : 1)));
                firstDayOfWeek.setHours(0,0,0,0);
                const lastDayOfWeek = new Date(firstDayOfWeek);
                lastDayOfWeek.setDate(lastDayOfWeek.getDate() + 6);
                lastDayOfWeek.setHours(23,59,59,999);
                return date >= firstDayOfWeek && date <= lastDayOfWeek;
            };
            const isThisMonth = (date) => {
                const today = new Date();
                return date.getMonth() === today.getMonth() && date.getFullYear() === today.getFullYear();
            };

            const filteredSales = useMemo(() => {
                return sales.filter(sale => {
                    const saleDate = new Date(sale.createdAt);
                    if (filter === 'today') return isToday(saleDate);
                    if (filter === 'week') return isThisWeek(saleDate);
                    if (filter === 'month') return isThisMonth(saleDate);
                    return true;
                });
            }, [sales, filter]);

            const stats = useMemo(() => {
                const totalRevenue = filteredSales.reduce((acc, sale) => acc + sale.total, 0);
                const totalProfit = filteredSales.reduce((acc, sale) => acc + sale.profit, 0);
                const salesCount = filteredSales.length;
                const avgCheck = salesCount > 0 ? totalRevenue / salesCount : 0;
                const avgProfit = salesCount > 0 ? totalProfit / salesCount : 0;

                const productStats = filteredSales.flatMap(sale => sale.items).reduce((acc, item) => {
                    if (!acc[item.name]) acc[item.name] = { name: item.name, count: 0, revenue: 0, profit: 0, unit: item.unit };
                    acc[item.name].count += item.quantity;
                    acc[item.name].revenue += item.sale_price * item.quantity;
                    acc[item.name].profit += (item.sale_price - item.purchase_price) * item.quantity;
                    return acc;
                }, {});

                const topProducts = Object.values(productStats).sort((a, b) => b.count - a.count).slice(0, 5);
                const topRevenueProducts = Object.values(productStats).sort((a, b) => b.revenue - a.revenue).slice(0, 5);

                const dailyData = filteredSales.reduce((acc, sale) => {
                    const day = new Date(sale.createdAt).toLocaleDateString('ru-RU');
                    if (!acc[day]) acc[day] = { name: day, total: 0, profit: 0, count: 0 };
                    acc[day].total += sale.total;
                    acc[day].profit += sale.profit;
                    acc[day].count += 1;
                    return acc;
                }, {});

                const chartData = Object.values(dailyData)
                    .sort((a,b) => new Date(a.name.split('.').reverse().join('-')) - new Date(b.name.split('.').reverse().join('-')));

                // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                const categoryStats = filteredSales.flatMap(sale => sale.items).reduce((acc, item) => {
                    const category = item.category || '–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏';
                    if (!acc[category]) acc[category] = { name: category, revenue: 0, profit: 0 };
                    acc[category].revenue += item.sale_price * item.quantity;
                    acc[category].profit += (item.sale_price - item.purchase_price) * item.quantity;
                    return acc;
                }, {});

                const topCategories = Object.values(categoryStats).sort((a, b) => b.revenue - a.revenue).slice(0, 5);

                return {
                    totalRevenue, totalProfit, salesCount, avgCheck, avgProfit,
                    topProducts, topRevenueProducts, chartData, topCategories
                };
            }, [filteredSales]);

            const FilterButton = ({ value, label }) => (
                <button onClick={() => setFilter(value)} className={`px-2.5 py-1 rounded-full text-xs font-medium ${
                    filter === value ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`}>{label}</button>
            );

            const { exportStatsToExcel } = useData();

            if (loading) return <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>;

            return (
                <div className="space-y-4 fade-in">
                    <h1 className="text-2xl font-bold">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h1>
                    <div className="flex flex-wrap gap-1.5">
                        <FilterButton value="today" label="–°–µ–≥–æ–¥–Ω—è" />
                        <FilterButton value="week" label="–ù–µ–¥–µ–ª—è" />
                        <FilterButton value="month" label="–ú–µ—Å—è—Ü" />
                        <FilterButton value="all" label="–í—Å–µ –≤—Ä–µ–º—è" />
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <StatCard title="–ß–µ–∫–æ–≤" value={stats.salesCount} />
                        <StatCard title="–í—ã—Ä—É—á–∫–∞" value={`${stats.totalRevenue.toFixed(2)} ‚ÇΩ`} />
                        <StatCard title="–ü—Ä–∏–±—ã–ª—å" value={`${stats.totalProfit.toFixed(2)} ‚ÇΩ`} />
                        <StatCard title="–°—Ä–µ–¥–Ω–∏–π —á–µ–∫" value={`${stats.avgCheck.toFixed(2)} ‚ÇΩ`} />
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="bg-white p-4 rounded-lg shadow">
                            <h2 className="text-lg font-bold mb-3">–î–∏–Ω–∞–º–∏–∫–∞</h2>
                            <ChartComponent data={stats.chartData} />
                        </div>
                        <div className="bg-white p-4 rounded-lg shadow">
                            <h2 className="text-lg font-bold mb-3">–¢–æ–ø-5 –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É</h2>
                            <div className="space-y-1.5">
                                {stats.topProducts.length === 0 ? <p className="text-sm">–ü—Ä–æ–¥–∞–∂ –Ω–µ—Ç.</p> :
                                    stats.topProducts.map(p => (
                                        <div key={p.name} className="flex justify-between p-2 bg-gray-50 rounded text-sm">
                                            <span className="font-medium">{p.name}</span>
                                            <span className="font-bold">{p.count.toFixed(p.unit === 'kg' ? 3 : 0)} {p.unit}</span>
                                        </div>
                                    ))
                                }
                            </div>
                        </div>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow">
                        <h2 className="text-lg font-bold mb-3">–¢–æ–ø-5 –ø–æ –≤—ã—Ä—É—á–∫–µ</h2>
                        <div className="space-y-1.5">
                            {stats.topRevenueProducts.length === 0 ? <p className="text-sm">–ü—Ä–æ–¥–∞–∂ –Ω–µ—Ç.</p> :
                                stats.topRevenueProducts.map(p => (
                                    <div key={p.name} className="flex justify-between p-2 bg-gray-50 rounded text-sm">
                                        <span className="font-medium">{p.name}</span>
                                        <span className="font-bold">{p.revenue.toFixed(2)} ‚ÇΩ</span>
                                    </div>
                                ))
                            }
                        </div>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow">
                        <h2 className="text-lg font-bold mb-3">–¢–æ–ø-5 –∫–∞—Ç–µ–≥–æ—Ä–∏–π</h2>
                        <div className="space-y-1.5">
                            {stats.topCategories.length === 0 ? <p className="text-sm">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</p> :
                                stats.topCategories.map(c => (
                                    <div key={c.name} className="flex justify-between p-2 bg-gray-50 rounded text-sm">
                                        <span className="font-medium">{c.name}</span>
                                        <span className="font-bold">–í—ã—Ä—É—á–∫–∞: {c.revenue.toFixed(2)} ‚ÇΩ | –ü—Ä–∏–±—ã–ª—å: {c.profit.toFixed(2)} ‚ÇΩ</span>
                                    </div>
                                ))
                            }
                        </div>
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow">
                        <h2 className="text-lg font-bold mb-3">–≠–∫—Å–ø–æ—Ä—Ç</h2>
                        <button onClick={() => exportStatsToExcel(stats)} className="w-full py-2 px-3 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-medium">[‚¨áÔ∏è] –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</button>
                    </div>
                </div>
            );
        }

        function StatCard({ title, value }) {
            return (
                <div className="bg-white p-4 rounded-lg shadow">
                    <h3 className="text-xs font-medium text-gray-500 uppercase">{title}</h3>
                    <p className="text-2xl font-bold mt-1">{value}</p>
                </div>
            );
        }

        function ChartComponent({ data }) {
            const canvasRef = useRef(null);
            const chartRef = useRef(null);

            useEffect(() => {
                if (!Chart) return;
                const ctx = canvasRef.current; if (!ctx) return;
                if (chartRef.current) chartRef.current.destroy();

                const labels = data.map(d => d.name);
                const totalData = data.map(d => d.total);
                const profitData = data.map(d => d.profit);

                chartRef.current = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels,
                        datasets: [
                            { label: '–í—ã—Ä—É—á–∫–∞ (‚ÇΩ)',  totalData, backgroundColor: 'rgba(59, 130, 246, 0.7)', yAxisID: 'y' },
                            { label: '–ü—Ä–∏–±—ã–ª—å (‚ÇΩ)',  profitData, backgroundColor: 'rgba(16, 185, 129, 0.7)', yAxisID: 'y1' }
                        ]
                    },
                    options: {
                        responsive: true,
                        interaction: { mode: 'index', intersect: false },
                        scales: {
                            y: { type: 'linear', display: true, position: 'left', title: { display: true, text: '–í—ã—Ä—É—á–∫–∞' } },
                            y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: '–ü—Ä–∏–±—ã–ª—å' }, grid: { drawOnChartArea: false } },
                        }
                    }
                });

                return () => { if (chartRef.current) chartRef.current.destroy(); };
            }, [data]);

            return <canvas ref={canvasRef}></canvas>;
        }

        function ChecksPage() {
            const { sales, loading } = useData();
            const [filter, setFilter] = useState('all');
            const [selectedCheck, setSelectedCheck] = useState(null);

            const isToday = (date) => {
                const today = new Date();
                return date.getDate() === today.getDate() && date.getMonth() === today.getMonth() && date.getFullYear() === today.getFullYear();
            };
            const isThisWeek = (date) => {
                const today = new Date();
                const firstDayOfWeek = new Date(today.setDate(today.getDate() - today.getDay() + (today.getDay() === 0 ? -6 : 1)));
                firstDayOfWeek.setHours(0,0,0,0);
                const lastDayOfWeek = new Date(firstDayOfWeek);
                lastDayOfWeek.setDate(lastDayOfWeek.getDate() + 6);
                lastDayOfWeek.setHours(23,59,59,999);
                return date >= firstDayOfWeek && date <= lastDayOfWeek;
            };
            const isThisMonth = (date) => {
                const today = new Date();
                return date.getMonth() === today.getMonth() && date.getFullYear() === today.getFullYear();
            };

            const filteredSales = useMemo(() => {
                return sales.filter(sale => {
                    const saleDate = new Date(sale.createdAt);
                    if (filter === 'today') return isToday(saleDate);
                    if (filter === 'week') return isThisWeek(saleDate);
                    if (filter === 'month') return isThisMonth(saleDate);
                    return true;
                });
            }, [sales, filter]);

            const FilterButton = ({ value, label }) => (
                <button onClick={() => setFilter(value)} className={`px-2.5 py-1 rounded-full text-xs font-medium ${
                    filter === value ? 'bg-blue-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
                }`}>{label}</button>
            );

            if (loading) return <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>;

            return (
                <div className="space-y-4 fade-in">
                    <h1 className="text-2xl font-bold">–ß–µ–∫–∏</h1>
                    <div className="flex flex-wrap gap-1.5">
                        <FilterButton value="today" label="–°–µ–≥–æ–¥–Ω—è" />
                        <FilterButton value="week" label="–ù–µ–¥–µ–ª—è" />
                        <FilterButton value="month" label="–ú–µ—Å—è—Ü" />
                        <FilterButton value="all" label="–í—Å–µ –≤—Ä–µ–º—è" />
                    </div>
                    <div className="bg-white p-4 rounded-lg shadow">
                        <h2 className="text-lg font-bold mb-3">–°–ø–∏—Å–æ–∫ —á–µ–∫–æ–≤</h2>
                        <div className="space-y-2 overflow-auto max-h-96">
                            {filteredSales.length === 0 ? <p className="text-sm">–ß–µ–∫–æ–≤ –Ω–µ—Ç.</p> :
                                filteredSales.map(sale => (
                                    <div key={sale.id} className="flex justify-between p-2 bg-gray-50 rounded text-sm cursor-pointer hover:bg-gray-100" onClick={() => setSelectedCheck(sale)}>
                                        <div>
                                            <p className="font-medium">{sale.type === 'sale' ? '–ü—Ä–æ–¥–∞–∂–∞' : '–í–æ–∑–≤—Ä–∞—Ç'} #{sale.id.substring(0, 8)}</p>
                                            <p className="text-xs text-gray-500">{new Date(sale.createdAt).toLocaleString()}</p>
                                        </div>
                                        <div className={`font-bold ${sale.type === 'sale' ? 'text-green-500' : 'text-red-500'}`}>
                                            {sale.type === 'sale' ? '+' : '-'}{sale.total.toFixed(2)} ‚ÇΩ
                                        </div>
                                    </div>
                                ))
                            }
                        </div>
                    </div>
                    {selectedCheck && <CheckDetailsModal check={selectedCheck} onClose={() => setSelectedCheck(null)} />}
                </div>
            );
        }

        function CheckDetailsModal({ check, onClose }) {
            const { products } = useData();
            return (
                <Modal title={`–î–µ—Ç–∞–ª–∏ —á–µ–∫–∞ ${check.type === 'sale' ? '–ü—Ä–æ–¥–∞–∂–∞' : '–í–æ–∑–≤—Ä–∞—Ç'} #${check.id.substring(0, 8)}`} onClose={onClose}>
                    <div className="space-y-2">
                        <div className="flex justify-between">
                            <span className="font-semibold">–î–∞—Ç–∞:</span>
                            <span>{new Date(check.createdAt).toLocaleString()}</span>
                        </div>
                        <div className="flex justify-between">
                            <span className="font-semibold">–¢–∏–ø:</span>
                            <span>{check.type === 'sale' ? '–ü—Ä–æ–¥–∞–∂–∞' : '–í–æ–∑–≤—Ä–∞—Ç'}</span>
                        </div>
                        <div className="flex justify-between">
                            <span className="font-semibold">–û–±—â–∞—è —Å—É–º–º–∞:</span>
                            <span className={`font-bold ${check.type === 'sale' ? 'text-green-500' : 'text-red-500'}`}>
                                {check.type === 'sale' ? '+' : '-'}{check.total.toFixed(2)} ‚ÇΩ
                            </span>
                        </div>
                        <div className="flex justify-between">
                            <span className="font-semibold">–ü—Ä–∏–±—ã–ª—å:</span>
                            <span className={`font-bold ${check.profit >= 0 ? 'text-green-500' : 'text-red-500'}`}>
                                {check.profit >= 0 ? '+' : ''}{check.profit.toFixed(2)} ‚ÇΩ
                            </span>
                        </div>
                    </div>
                    <div className="mt-4">
                        <h3 className="text-md font-bold mb-2">–¢–æ–≤–∞—Ä—ã:</h3>
                        <div className="space-y-1">
                            {check.items.map(item => (
                                <div key={item.id} className="flex justify-between p-1 bg-gray-50 rounded">
                                    <div className="flex-1">
                                        <span className="font-medium">{item.name}</span>
                                        <span className="text-xs text-gray-500"> ({item.quantity} {item.unit})</span>
                                    </div>
                                    <div className="flex items-center gap-2">
                                        <span className="text-xs">–¶–µ–Ω–∞: {item.sale_price} ‚ÇΩ</span>
                                        <span className="font-bold">{(item.sale_price * item.quantity).toFixed(2)} ‚ÇΩ</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className="mt-4 flex justify-end gap-2 pt-3">
                        <button type="button" onClick={onClose} className="py-1.5 px-3 bg-gray-200 hover:bg-gray-300 rounded text-sm font-medium">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </Modal>
            );
        }

        function CategoriesPage() {
            const { products, loading } = useData();
            const [categories, setCategories] = useState([]);
            const [showModal, setShowModal] = useState(false);
            const [categoryToEdit, setCategoryToEdit] = useState(null);
            const [search, setSearch] = useState('');

            useEffect(() => {
                const allCategories = products.map(p => p.category).filter(Boolean);
                setCategories([...new Set(allCategories)]);
            }, [products]);

            const filteredCategories = useMemo(() => {
                return categories.filter(cat => cat.toLowerCase().includes(search.toLowerCase()));
            }, [categories, search]);

            const addCategory = (name) => {
                if (!name.trim()) return;
                const newCat = name.trim();
                if (categories.includes(newCat)) return;
                setCategories(prev => [...prev, newCat]);
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
                // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã, –º—ã –ø—Ä–æ—Å—Ç–æ –æ–±–Ω–æ–≤–∏–º —Å–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π, –∞ —Å–∞–º–∏ —Ç–æ–≤–∞—Ä—ã –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–æ–º –º–µ—Å—Ç–µ.
            };

            const deleteCategory = (name) => {
                if (window.confirm(`–£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é "${name}"? –í—Å–µ —Ç–æ–≤–∞—Ä—ã –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ "–ë–µ–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏".`)) {
                    setCategories(prev => prev.filter(cat => cat !== name));
                    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã —Å —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ category: ''
                }
            };

            const editCategory = (oldName, newName) => {
                if (!newName.trim()) return;
                const trimmedNewName = newName.trim();
                if (trimmedNewName === oldName) return;
                if (categories.includes(trimmedNewName)) return;
                setCategories(prev => prev.map(cat => cat === oldName ? trimmedNewName : cat));
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –±—ã–ª–æ –±—ã –æ–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Ç–æ–≤–∞—Ä—ã —Å —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π, —É—Å—Ç–∞–Ω–æ–≤–∏–≤ category: trimmedNewName
            };

            return (
                <div className="fade-in">
                    <div className="flex flex-col md:flex-row gap-3 mb-3">
                        <div className="flex-1">
                            <h1 className="text-2xl font-bold mb-0">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ–≤–∞—Ä–æ–≤</h1>
                        </div>
                        <button className="h-8 px-3 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-medium" onClick={() => { setCategoryToEdit(null); setShowModal(true); }}>[+] –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é</button>
                    </div>
                    <div className="flex flex-col md:flex-row gap-3 mb-3">
                        <div className="relative flex-1">
                            <input type="text" placeholder="–ü–æ–∏—Å–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏..." className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" value={search} onChange={(e) => setSearch(e.target.value)} />
                        </div>
                    </div>
                    {loading ? (<p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>) : (
                        <div className="bg-white rounded-lg shadow overflow-hidden">
                            <table className="w-full text-left">
                                <thead className="border-b">
                                    <tr>
                                        <th className="p-3 text-sm font-medium">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</th>
                                        <th className="p-3 text-sm font-medium w-10"></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {filteredCategories.map(category => (
                                        <tr key={category} className={`border-b last:border-0 hover:bg-gray-50`}>
                                            <td className="p-3 text-sm">{category}</td>
                                            <td className="p-3 text-right">
                                                <button onClick={() => { setCategoryToEdit(category); setShowModal(true); }} className="text-blue-500 text-sm mr-2">[‚úèÔ∏è]</button>
                                                <button onClick={() => deleteCategory(category)} className="text-red-500 text-sm">[üóëÔ∏è]</button>
                                            </td>
                                        </tr>
                                    ))}
                                </tbody>
                            </table>
                            {filteredCategories.length === 0 && <p className="p-3 text-center text-gray-500 text-sm">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>}
                        </div>
                    )}
                    {showModal && <CategoryModal category={categoryToEdit} onClose={() => setShowModal(false)} onSave={categoryToEdit ? editCategory : addCategory} />}
                </div>
            );
        }

        function CategoryModal({ category, onClose, onSave }) {
            const [name, setName] = useState(category || '');
            const [isEditing, setIsEditing] = useState(!!category);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!name.trim()) return;
                onSave(isEditing ? category : '', name.trim());
                onClose();
            };

            return (
                <Modal title={isEditing ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é' : '–ù–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è'} onClose={onClose}>
                    <form onSubmit={handleSubmit} className="space-y-3">
                        <div>
                            <label className="block text-sm font-medium mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏*</label>
                            <input value={name} onChange={(e) => setName(e.target.value)} className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" required />
                        </div>
                        <div className="flex justify-end gap-2 pt-3">
                            <button type="button" onClick={onClose} className="py-1.5 px-3 bg-gray-200 hover:bg-gray-300 rounded text-sm font-medium">–û—Ç–º–µ–Ω–∞</button>
                            <button type="submit" className="py-1.5 px-3 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-medium">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        </div>
                    </form>
                </Modal>
            );
        }

        function LoadingScreen() {
            return (
                <div className="flex flex-col items-center justify-center min-h-screen bg-gray-100">
                    <h1 className="text-2xl font-bold text-blue-500 mb-2 animate-pulse">üí∞ My Shop v8</h1>
                    <p className="text-sm">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                </div>
            );
        }

        function Modal({ title, children, onClose }) {
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm flex justify-center items-center z-50" onClick={onClose}>
                    <div className="bg-white p-4 w-full max-w-md m-4 rounded-lg shadow-lg fade-in" onClick={(e) => e.stopPropagation()}>
                        <div className="flex justify-between items-center mb-3">
                            <h3 className="text-lg font-bold">{title}</h3>
                            <button onClick={onClose} className="text-gray-500 hover:text-gray-800 text-lg">[X]</button>
                        </div>
                        {children}
                    </div>
                </div>
            );
        }

        function ProductModal({ product, onClose }) {
            const { saveProduct, getProductByBarcode, categories } = useData();
            const [formData, setFormData] = useState({
                id: product ? product.id : `prod_${Date.now()}`,
                name: product ? product.name : '',
                barcode: product ? product.barcode : '',
                purchase_price: product ? product.purchase_price : 0,
                sale_price: product ? product.sale_price : 0,
                stock: product ? product.stock : 0,
                category: product ? product.category : '',
                unit: product ? product.unit : 'pcs',
                low_stock_threshold: product ? product.low_stock_threshold : 5,
            });
            const [showScanner, setShowScanner] = useState(false);

            const handleChange = (e) => {
                const { name, value, type } = e.target;
                const val = type === 'number' ? (value === '' ? '' : parseFloat(value) || 0) : value;
                setFormData(prev => ({ ...prev, [name]: val }));
            };

            const onScanSuccess = (decodedText) => {
                if (getProductByBarcode(decodedText) && (!product || product.barcode !== decodedText)) alert("–≠—Ç–æ—Ç —à—Ç—Ä–∏—Ö-–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!");
                else setFormData(prev => ({ ...prev, barcode: decodedText }));
                setShowScanner(false);
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!formData.name || !formData.sale_price || formData.sale_price <= 0) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∏ —Ü–µ–Ω—É –ø—Ä–æ–¥–∞–∂–∏ (>0)'); return; }
                const existing = getProductByBarcode(formData.barcode);
                if (formData.barcode && existing && existing.id !== formData.id) { alert("–≠—Ç–æ—Ç —à—Ç—Ä–∏—Ö-–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!"); return; }
                const normalized = {
                    ...formData,
                    stock: formData.stock === '' ? 0 : formData.stock,
                    low_stock_threshold: formData.low_stock_threshold === '' ? 5 : formData.low_stock_threshold
                };
                saveProduct(normalized); onClose();
            };

            return (
                <Modal title={product ? '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '–ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä'} onClose={onClose}>
                    {!showScanner ? (
                        <form onSubmit={handleSubmit} className="space-y-3">
                            <div>
                                <label className="block text-sm font-medium mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ*</label>
                                <input name="name" value={formData.name} onChange={handleChange} className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" required />
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-1">–ï–¥. –∏–∑–º.*</label>
                                <select name="unit" value={formData.unit} onChange={handleChange} className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm">
                                    <option value="pcs">—à—Ç. (–ü–æ—à—Ç—É—á–Ω–æ)</option>
                                    <option value="kg">–∫–≥ (–ù–∞ —Ä–∞–∑–≤–µ—Å)</option>
                                </select>
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-1">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                <input name="category" value={formData.category} onChange={handleChange} className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" list="categories-list" />
                                <datalist id="categories-list">{categories.map(c => <option key={c} value={c} />)}</datalist>
                            </div>
                            <div>
                                <label className="block text-sm font-medium mb-1">–®—Ç—Ä–∏—Ö-–∫–æ–¥</label>
                                <div className="flex gap-1.5">
                                    <input name="barcode" value={formData.barcode} onChange={handleChange} className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" />
                                    <button type="button" onClick={() => setShowScanner(true)} className="px-2 py-1.5 bg-gray-200 hover:bg-gray-300 rounded text-sm">[|||]</button>
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <label className="block text-sm font-medium mb-1">–¶–µ–Ω–∞ –∑–∞–∫—É–ø–∫–∏ (‚ÇΩ)</label>
                                    <input name="purchase_price" type="number" step="0.01" value={formData.purchase_price} onChange={handleChange} className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-1">–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏ (‚ÇΩ / {formData.unit})*</label>
                                    <input name="sale_price" type="number" step="0.01" value={formData.sale_price} onChange={handleChange} className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" required />
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-3">
                                <div>
                                    <label className="block text-sm font-medium mb-1">–ù–∞—á–∞–ª—å–Ω—ã–π –æ—Å—Ç–∞—Ç–æ–∫ ({formData.unit})</label>
                                    <input name="stock" type="number" step={formData.unit === 'kg' ? "0.001" : "1"} value={formData.stock} onChange={handleChange} className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-1">–ü–æ—Ä–æ–≥ –Ω–∏–∑–∫–æ–≥–æ –æ—Å—Ç–∞—Ç–∫–∞ ({formData.unit})</label>
                                    <input name="low_stock_threshold" type="number" step={formData.unit === 'kg' ? "0.001" : "1"} value={formData.low_stock_threshold} onChange={handleChange} className="w-full px-2 py-1.5 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-sm" />
                                </div>
                            </div>
                            <div className="flex justify-end gap-2 pt-3">
                                <button type="button" onClick={onClose} className="py-1.5 px-3 bg-gray-200 hover:bg-gray-300 rounded text-sm font-medium">–û—Ç–º–µ–Ω–∞</button>
                                <button type="submit" className="py-1.5 px-3 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-medium">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                            </div>
                        </form>
                    ) : (
                        <div>
                            <BarcodeScannerComponent onSuccess={onScanSuccess} onError={(err) => console.warn(err)} />
                            <button onClick={() => setShowScanner(false)} className="w-full py-2 px-3 bg-gray-200 hover:bg-gray-300 rounded text-sm font-medium mt-3">–ù–∞–∑–∞–¥</button>
                        </div>
                    )}
                </Modal>
            );
        }

        function WeightInputModal({ product, onClose, onConfirm }) {
            const [weight, setWeight] = useState(1.000);
            const maxWeight = product.stock;
            const handleSubmit = (e) => { e.preventDefault(); const floatWeight = parseFloat(weight); if (floatWeight > 0) onConfirm(floatWeight); };

            return (
                <Modal title={`–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å (${product.unit})`} onClose={onClose}>
                    <p className="mb-2 text-sm">–¢–æ–≤–∞—Ä: <span className="font-medium">{product.name}</span></p>
                    <p className="mb-3 text-xs text-gray-500">–¶–µ–Ω–∞: {product.sale_price} ‚ÇΩ/{product.unit} | –û—Å—Ç–∞—Ç–æ–∫: {maxWeight.toFixed(3)} {product.unit}</p>
                    <form onSubmit={handleSubmit} className="space-y-3">
                        <div>
                            <label className="block text-sm font-medium mb-1">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ ({product.unit})</label>
                            <input type="number" step="0.001" min="0.001" max={maxWeight} value={weight}
                                onChange={(e) => setWeight(e.target.value)} className="w-full px-3 py-3 border border-gray-300 rounded bg-white focus:outline-none focus:ring-1 focus:ring-blue-500 text-xl text-center" autoFocus required />
                        </div>
                        <div className="flex justify-end gap-2 pt-3">
                            <button type="button" onClick={onClose} className="py-1.5 px-3 bg-gray-200 hover:bg-gray-300 rounded text-sm font-medium">–û—Ç–º–µ–Ω–∞</button>
                            <button type="submit" className="py-1.5 px-3 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm font-medium">–î–æ–±–∞–≤–∏—Ç—å {(weight * product.sale_price).toFixed(2)} ‚ÇΩ</button>
                        </div>
                    </form>
                </Modal>
            );
        }

        function BarcodeScannerComponent({ onSuccess, onError }) {
            const scannerRef = useRef(null);
            const [isScanning, setIsScanning] = useState(false);

            useEffect(() => {
                if (!Html5Qrcode) { console.error("–°–∫–∞–Ω–µ—Ä (Html5Qrcode) –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!"); return; }
                const scanner = new Html5Qrcode("scanner-container"); scannerRef.current = scanner;
                setIsScanning(true);
                scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: { width: 250, height: 150 } }, onSuccess, onError)
                    .catch(() => {
                        scanner.start({}, { fps: 10, qrbox: { width: 250, height: 150 } }, onSuccess, onError)
                            .catch(err2 => console.error("–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞ —Å–∫–∞–Ω–µ—Ä–∞:", err2));
                    })
                    .finally(() => setIsScanning(false));
                return () => {
                    try { if (scannerRef.current && scannerRef.current.isScanning) scannerRef.current.stop(); }
                    catch (err) { console.warn("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ —Å–∫–∞–Ω–µ—Ä–∞:", err); }
                };
            }, [onSuccess, onError]);

            return (
                <div>
                    {isScanning && <div className="text-center mb-3">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ... <span className="animate-spin">‚è≥</span></div>}
                    <div id="scanner-container" className="w-full rounded-lg overflow-hidden"></div>
                </div>
            );
        }

        function Notification({ message, type = 'success' }) {
            const colors = { success: 'bg-green-500', error: 'bg-red-500', warning: 'bg-yellow-500' };
            return (
                <div className={`fixed bottom-20 md:bottom-4 left-1/2 -translate-x-1/2 p-3 rounded-lg text-white shadow-lg z-50 ${colors[type]}`}>
                    {message}
                </div>
            );
        }

        function Root() {
            if (!React || !ReactDOM || !Babel) {
                return (
                    <div style={{ padding: '20px', fontFamily: 'sans-serif', color: 'red' }}>
                        <h1>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏...</h1>
                        <p>–û—Å–Ω–æ–≤–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (React, Babel) –Ω–µ —Å–º–æ–≥–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è.</p>
                        <p>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É.</p>
                    </div>
                );
            }
            return (
                <DataProvider>
                    <NavigationProvider>
                        <App />
                    </NavigationProvider>
                </DataProvider>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Root />);
    </script>
</body>
</html>